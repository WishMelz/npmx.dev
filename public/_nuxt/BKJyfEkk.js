import{$ as e,A as t,At as n,C as r,D as i,Dt as a,F as o,J as s,L as c,Mt as l,Nt as u,O as d,S as f,Y as p,Z as m,_ as h,at as g,b as _,et as v,ht as y,l as b,lt as x,m as S,n as C,ot as w,rt as T,st as E,u as D,ut as O,w as k,x as A,yt as j}from"./BLt7TXlb.js";import{B as M,b as N,d as P,t as F,u as I,z as L}from"./CreLCcZP.js";import"./Cr_GQgS6.js";import{t as R}from"./BFu3gPrq.js";import{n as z}from"./DZubR30v.js";import{t as ee,y as B}from"./-B2-_an5.js";import"./CdWQmgpE.js";import{t as V}from"./Bi22IuVY.js";import{d as H,f as U,l as W}from"./Brdikwlz.js";import"./gZojCxWl.js";import"./DQw8S1UI.js";import"./B5EGaAMl.js";import{t as te}from"./DtKNaDAW.js";import{t as ne}from"./CJj7aYYR.js";var G=[`onClick`],K={class:`truncate`},q=[`onClick`],J={class:`truncate`},Y=t({__name:`FileTree`,props:{files:{},selectedPath:{},treeNodes:{},depth:{}},emits:[`select`],setup(t,{emit:i}){let o=t,c=i,d=_(()=>o.depth??0);function p(e){return e.map(e=>({...e,children:e.children?p(e.children):void 0})).sort((e,t)=>e.type===t.type?e.name.localeCompare(t.name):e.type===`directory`?-1:1)}function h(e){let t=[];for(let n of e){let e=n.path.split(`/`),r=t;for(let t=0;t<e.length;t++){let i=e[t],a=t===e.length-1,o=e.slice(0,t+1).join(`/`),s=r.find(e=>e.name===i);s||(s={name:i,path:o,type:a?`file`:`directory`,changeType:a?n.type:void 0,children:a?void 0:[]},r.push(s)),a||(r=s.children)}}return p(t)}let g=_(()=>o.treeNodes??h(o.files));function v(e){return!!(o.selectedPath===e.path||o.selectedPath?.startsWith(e.path+`/`))}let y=j(new Set);function b(e){for(let t of e)t.type===`directory`&&(y.value.add(t.path),t.children&&b(t.children))}E(()=>{(o.depth===void 0||o.depth===0)&&b(g.value)});function x(e){y.value.has(e)?y.value.delete(e):y.value.add(e)}function C(e){return y.value.has(e)}function w(e){switch(e){case`added`:return`i-lucide:file-plus text-green-500`;case`removed`:return`i-lucide:file-minus text-red-500`;case`modified`:return`i-lucide:file-diff text-yellow-500`}}function T(e){let t=o.files.find(t=>t.path===e.path);t&&c(`select`,t)}return(i,o)=>{let p=e(`FileTree`,!0);return s(),k(`ul`,{class:n([`list-none m-0 p-0`,a(d)===0?`py-2`:``])},[(s(!0),k(S,null,m(a(g),e=>(s(),k(`li`,{key:e.path},[e.type===`directory`?(s(),k(S,{key:0},[A(`button`,{type:`button`,class:n([`w-full flex items-center gap-1.5 py-1.5 px-3 text-start font-mono text-sm transition-colors hover:bg-bg-muted`,v(e)?`text-fg`:`text-fg-muted`]),style:l({paddingLeft:`${a(d)*12+12}px`}),onClick:t=>x(e.path)},[A(`span`,{class:n([`w-4 h-4 shrink-0 transition-transform`,[C(e.path)?`i-lucide:chevron-down`:`i-lucide:chevron-right`]])},null,2),A(`span`,{class:n([`w-4 h-4 shrink-0`,C(e.path)?`i-lucide:folder-open text-yellow-500`:`i-lucide:folder text-yellow-600`])},null,2),A(`span`,K,u(e.name),1)],14,G),C(e.path)&&e.children?(s(),f(p,{key:0,files:t.files,"tree-nodes":e.children,"selected-path":t.selectedPath,depth:a(d)+1,onSelect:o[0]||=e=>c(`select`,e)},null,8,[`files`,`tree-nodes`,`selected-path`,`depth`])):r(``,!0)],64)):(s(),k(`button`,{key:1,type:`button`,class:n([`w-full flex items-center gap-1.5 py-1.5 px-3 font-mono text-sm transition-colors hover:bg-bg-muted text-start`,t.selectedPath===e.path?`bg-bg-muted text-fg`:`text-fg-muted`]),style:l({paddingLeft:`${a(d)*12+32}px`}),onClick:t=>T(e)},[A(`span`,{class:n([`w-4 h-4 shrink-0`,w(e.changeType)])},null,2),A(`span`,J,u(e.name),1)],14,q))]))),128))],2)}}}),X=Object.assign(Y,{__name:`DiffFileTree`}),Z={class:`flex flex-col min-h-0`},re={class:`border-b border-border shrink-0`},ie={class:`px-3 py-2.5 border-b border-border`},ae={class:`flex flex-wrap items-center justify-between gap-2`},oe={class:`text-xs font-medium flex items-center gap-1.5`},se={class:`flex items-center gap-3 font-mono text-3xs`},ce={class:`flex items-center gap-1`},le={class:`text-green-500`},ue={class:`text-red-500`},de={class:`text-yellow-500`},fe={key:0,class:`text-fg-muted`},pe={key:0,class:`px-3 py-2 bg-yellow-500/5 border-b border-border`},me={class:`flex items-start gap-2`},he={class:`text-3xs text-fg-muted`},ge={key:1,class:`px-3 py-2.5 space-y-2`},_e={class:`cursor-pointer list-none flex items-center gap-2 text-xs font-medium mb-2 hover:text-fg transition-colors`},ve={class:`space-y-1 ms-5 max-h-40 overflow-y-auto`},ye={class:`flex items-center gap-1.5 text-fg-muted font-mono text-3xs ms-auto shrink-0`},be={key:1,class:`i-lucide:arrow-right w-2.5 h-2.5`},xe={key:2},Se={key:2,class:`px-3 py-2 text-3xs text-fg-muted text-center`},Ce={class:`flex-1 flex flex-col open:flex-1 group min-h-0`,open:``},we={class:`border-b border-border px-3 py-2 shrink-0 cursor-pointer list-none flex items-center justify-between gap-2`},Te={class:`text-xs font-medium flex items-center gap-1.5`},Ee={class:`border-b border-border px-3 py-2 shrink-0 space-y-2`},De={class:`relative`},Oe=[`placeholder`,`aria-label`],ke={class:`flex items-center justify-end`},Ae=[`aria-label`],je={value:`all`},Me={value:`added`},Ne={value:`removed`},Pe={value:`modified`},Fe={class:`flex-1 overflow-y-auto min-h-0`},Ie={key:0,class:`p-8 text-center text-xs text-fg-muted`},Le=t({__name:`SidebarPanel`,props:c({compare:{},groupedDeps:{},allChanges:{},showSettings:{type:Boolean}},{selectedFile:{default:null},selectedFileModifiers:{},fileFilter:{default:`all`},fileFilterModifiers:{}}),emits:c([`file-select`],[`update:selectedFile`,`update:fileFilter`]),setup(e,{emit:t}){let o=e,c=t,l=T(e,`selectedFile`),p=T(e,`fileFilter`),h=[`dependencies`,`devDependencies`,`peerDependencies`,`optionalDependencies`],{t:g}=z(),v=_(()=>({dependencies:{label:g(`compare.dependencies`),icon:`i-lucide:box`},devDependencies:{label:g(`compare.dev_dependencies`),icon:`i-lucide:wrench`},peerDependencies:{label:g(`compare.peer_dependencies`),icon:`i-lucide:users`},optionalDependencies:{label:g(`compare.optional_dependencies`),icon:`i-lucide:circle-help`}})),C=_(()=>Array.from(o.groupedDeps.entries()).map(([e,t])=>({key:e,changes:t,label:v.value[e]?.label??e,icon:v.value[e]?.icon??`i-lucide:box`,order:h.indexOf(e)===-1?h.length+1:h.indexOf(e)})).sort((e,t)=>e.order-t.order)),w=j(``),E=_(()=>{let e=o.allChanges;if(p.value!==`all`&&(e=e.filter(e=>e.type===p.value)),w.value.trim()){let t=w.value.trim().toLowerCase();e=e.filter(e=>e.path.toLowerCase().includes(t))}return e});function M(e){switch(e){case`major`:return`bg-red-500/10 text-red-500`;case`minor`:return`bg-yellow-500/10 text-yellow-500`;case`patch`:return`bg-green-500/10 text-green-500`;case`prerelease`:return`bg-purple-500/10 text-purple-500`;default:return`bg-bg-muted text-fg-subtle`}}function N(e){l.value=e,c(`file-select`,e)}return(t,o)=>{let c=F,h=X;return s(),k(`div`,Z,[A(`div`,re,[A(`div`,ie,[A(`div`,ae,[A(`span`,oe,[o[2]||=A(`span`,{class:`i-lucide-lightbulb w-3.5 h-3.5`},null,-1),i(` `+u(t.$t(`compare.summary`)),1)]),A(`div`,se,[A(`span`,ce,[A(`span`,le,`+`+u(e.compare.stats.filesAdded),1),o[3]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,ue,`-`+u(e.compare.stats.filesRemoved),1),o[4]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,de,`~`+u(e.compare.stats.filesModified),1)]),e.compare.dependencyChanges.length>0?(s(),k(`span`,fe,u(t.$t(`compare.deps_count`,{count:e.compare.dependencyChanges.length})),1)):r(``,!0)])])]),e.compare.meta.warnings?.length?(s(),k(`div`,pe,[A(`div`,me,[o[5]||=A(`span`,{class:`i-lucide:triangle-alert w-3.5 h-3.5 text-yellow-500 shrink-0 mt-0.5`},null,-1),A(`div`,he,[(s(!0),k(S,null,m(e.compare.meta.warnings,e=>(s(),k(`p`,{key:e},u(e),1))),128))])])])):r(``,!0),e.compare.dependencyChanges.length>0?(s(),k(`div`,ge,[(s(!0),k(S,null,m(a(C),e=>(s(),k(`details`,{key:e.key,class:`group`},[A(`summary`,_e,[o[6]||=A(`span`,{class:`i-lucide:chevron-right w-3.5 h-3.5 transition-transform group-open:rotate-90`},null,-1),A(`span`,{class:n([e.icon,`w-3.5 h-3.5`])},null,2),i(` `+u(e.label)+` (`+u(e.changes.length)+`) `,1)]),A(`div`,ve,[(s(!0),k(S,null,m(e.changes,e=>(s(),k(`div`,{key:e.name,class:`flex items-center gap-2 text-xs py-0.5`},[A(`span`,{class:n([`w-3 h-3 shrink-0`,e.type===`added`?`i-lucide:plus text-green-500`:e.type===`removed`?`i-lucide:minus text-red-500`:`i-lucide:arrow-left-right text-yellow-500`])},null,2),d(c,{to:a(U)(e.name),class:`font-mono hover:text-fg transition-colors truncate min-w-0`},{default:x(()=>[i(u(e.name),1)]),_:2},1032,[`to`]),A(`div`,ye,[e.from?(s(),k(`span`,{key:0,class:n({"line-through opacity-50":e.type===`updated`})},u(e.from),3)):r(``,!0),e.type===`updated`?(s(),k(`span`,be)):r(``,!0),e.to?(s(),k(`span`,xe,u(e.to),1)):r(``,!0)]),e.semverDiff?(s(),k(`span`,{key:0,class:n([`text-4xs px-1.5 py-0.5 rounded font-medium shrink-0`,M(e.semverDiff)])},u(e.semverDiff),3)):r(``,!0)]))),128))])]))),128))])):r(``,!0),e.compare.dependencyChanges.length===0&&!e.compare.meta.warnings?.length?(s(),k(`div`,Se,u(t.$t(`compare.no_dependency_changes`)),1)):r(``,!0)]),A(`details`,Ce,[A(`summary`,we,[A(`span`,Te,[o[7]||=A(`span`,{class:`i-lucide:file-text w-3.5 h-3.5`},null,-1),i(` `+u(t.$t(`compare.file_changes`)),1)]),o[8]||=A(`span`,{class:`i-lucide:chevron-right w-3.5 h-3.5 transition-transform group-open:rotate-90`},null,-1)]),A(`div`,Ee,[A(`div`,De,[o[9]||=A(`span`,{class:`absolute inset-is-2 top-1/2 -translate-y-1/2 i-lucide:search w-3 h-3 text-fg-subtle pointer-events-none`},null,-1),O(A(`input`,{"onUpdate:modelValue":o[0]||=e=>y(w)?w.value=e:null,type:`search`,placeholder:t.$t(`compare.search_files_placeholder`),"aria-label":t.$t(`compare.search_files_placeholder`),class:`w-full text-2xs ps-6.5 pe-2 py-1 bg-bg-subtle border border-border rounded font-mono placeholder:text-fg-subtle transition-colors hover:border-border-hover focus:border-accent focus:outline-none`},null,8,Oe),[[D,a(w)]])]),A(`div`,ke,[O(A(`select`,{"onUpdate:modelValue":o[1]||=e=>p.value=e,"aria-label":t.$t(`compare.filter_files_label`),class:`text-3xs px-2 py-1 bg-bg-subtle border border-border rounded font-mono cursor-pointer hover:border-border-hover transition-colors`},[A(`option`,je,u(t.$t(`compare.file_filter_option.all`,{count:e.allChanges.length})),1),A(`option`,Me,u(t.$t(`compare.file_filter_option.added`,{count:e.compare.stats.filesAdded})),1),A(`option`,Ne,u(t.$t(`compare.file_filter_option.removed`,{count:e.compare.stats.filesRemoved})),1),A(`option`,Pe,u(t.$t(`compare.file_filter_option.modified`,{count:e.compare.stats.filesModified})),1)],8,Ae),[[b,p.value]])])]),A(`div`,Fe,[a(E).length===0?(s(),k(`div`,Ie,u(a(w).trim()?t.$t(`compare.no_files_search`,{query:a(w).trim()}):p.value===`all`?t.$t(`compare.no_files_all`):p.value===`added`?t.$t(`compare.no_files_filtered`,{filter:t.$t(`compare.filter.added`)}):p.value===`removed`?t.$t(`compare.no_files_filtered`,{filter:t.$t(`compare.filter.removed`)}):t.$t(`compare.no_files_filtered`,{filter:t.$t(`compare.filter.modified`)})),1)):(s(),f(h,{key:1,files:a(E),"selected-path":l.value?.path??null,onSelect:N},null,8,[`files`,`selected-path`]))])])])}}}),Q=Object.assign(Le,{__name:`DiffSidebarPanel`}),Re=[`data-line-new`,`data-line-old`,`data-line-kind`],ze={class:`tabular-nums text-center opacity-50 px-2 text-xs select-none w-12 shrink-0`},Be=[`innerHTML`],Ve=t({__name:`Line`,props:{line:{}},setup(e){let t=e,r=o(`diffContext`),i=_(()=>t.line.type===`normal`?t.line.newLineNumber:t.line.lineNumber??t.line.newLineNumber),c=_(()=>t.line.type===`normal`?t.line.oldLineNumber:t.line.type===`delete`?t.line.lineNumber??t.line.oldLineNumber:void 0),l=_(()=>{let e=r?.wordWrap?.value??!1,n=[`whitespace-pre-wrap`,`box-border`,`border-none`];e?n.push(`min-h-6`):n.push(`h-6`,`min-h-6`);let i=r?.fileStatus.value;return t.line.type===`insert`&&i!==`add`&&n.push(`bg-[var(--code-added)]/10`),t.line.type===`delete`&&i!==`delete`&&n.push(`bg-[var(--code-removed)]/10`),n}),d=_(()=>{let e=[`border-transparent`,`w-1`,`border-is-3`];return t.line.type===`insert`&&e.push(`border-[color:var(--code-added)]/60`),t.line.type===`delete`&&e.push(`border-[color:var(--code-removed)]/80`),e}),p=_(()=>[`pe-6`,r?.wordWrap?.value??!1?`whitespace-pre-wrap break-words`:`text-nowrap`]);function h(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`)}let g=_(()=>t.line.content.map(e=>({html:e.html??h(e.value),type:e.type})));return(t,r)=>(s(),k(`tr`,{"data-line-new":a(i),"data-line-old":a(c),"data-line-kind":e.line.type,class:n(a(l))},[A(`td`,{class:n(a(d))},null,2),A(`td`,ze,u(e.line.type===`delete`?`–`:a(i)),1),A(`td`,{class:n(a(p))},[(s(),f(v(e.line.type===`insert`?`ins`:e.line.type===`delete`?`del`:`span`),null,{default:x(()=>[(s(!0),k(S,null,m(a(g),(e,t)=>(s(),k(`span`,{key:t,class:n({"bg-[var(--code-added)]/20":e.type===`insert`,"bg-[var(--code-removed)]/20":e.type===`delete`}),innerHTML:e.html},null,10,Be))),128))]),_:1}))],2)],10,Re))}}),He=Object.assign(V(Ve,[[`__scopeId`,`data-v-da0fa903`]]),{__name:`DiffLine`}),Ue=t({__name:`Hunk`,props:{hunk:{}},setup(e){return(t,n)=>{let r=He;return s(!0),k(S,null,m(e.hunk.lines,(e,t)=>(s(),f(r,{key:t,line:e},null,8,[`line`]))),128)}}}),We=Object.assign(Ue,{__name:`DiffHunk`}),Ge={class:`h-10 font-mono bg-bg-muted text-fg-muted`},Ke={class:`px-0 sticky inset-is-2 italic opacity-50`},qe=t({__name:`SkipBlock`,props:{count:{},content:{}},setup(e){return(t,n)=>(s(),k(S,null,[n[2]||=A(`tr`,{class:`h-2`},null,-1),A(`tr`,Ge,[n[0]||=A(`td`,null,null,-1),n[1]||=A(`td`,{class:`opacity-50 select-none text-center`},[A(`span`,{class:`i-lucide:chevrons-up-down w-4 h-4`})],-1),A(`td`,null,[A(`span`,Ke,u(e.content||t.$t(`compare.lines_hidden`,{count:e.count})),1)])]),n[3]||=A(`tr`,{class:`h-2`},null,-1)],64))}}),Je=Object.assign(qe,{__name:`DiffSkipBlock`}),Ye={class:`diff-table shiki font-mono text-sm w-full m-0 border-separate border-0 outline-none overflow-x-auto border-spacing-0`},Xe={class:`w-full box-border`},Ze=t({__name:`Table`,props:{hunks:{},type:{},fileName:{},wordWrap:{type:Boolean}},setup(e){let t=e;return p(`diffContext`,{fileStatus:_(()=>t.type),wordWrap:_(()=>t.wordWrap??!1)}),(t,n)=>{let r=We,i=Je;return s(),k(`table`,Ye,[A(`tbody`,Xe,[(s(!0),k(S,null,m(e.hunks,(e,t)=>(s(),k(S,{key:t},[e.type===`hunk`?(s(),f(r,{key:0,hunk:e},null,8,[`hunk`])):(s(),f(i,{key:1,count:e.count,content:e.content},null,8,[`count`,`content`]))],64))),128))])])}}}),Qe=Object.assign(V(Ze,[[`__scopeId`,`data-v-431bbde8`]]),{__name:`DiffTable`}),$e=P(W),et={class:`h-full flex flex-col bg-bg`},tt={class:`flex flex-wrap items-center justify-between gap-3 px-4 py-3 bg-bg-subtle border-b border-border shrink-0`},nt={class:`flex items-center gap-3 min-w-0 flex-1`},rt={class:`font-mono text-sm truncate max-w-[65vw] sm:max-w-none`},it={key:0,class:`text-xs text-green-500 font-mono shrink-0`},at={key:1,class:`text-xs text-red-500 font-mono shrink-0`},ot={key:1,class:`text-xs text-fg-subtle shrink-0`},st={class:`flex items-center gap-2 shrink-0`},ct={class:`flex flex-col gap-2`},lt={class:`slider-labels`},ut={class:`slider-value tabular-nums`},dt={class:`slider-track`},ft=[`disabled`],pt={class:`slider-labels`},mt={class:`slider-value tabular-nums`},ht={class:`slider-track`},gt=[`disabled`],_t={class:`slider-labels`},vt={class:`slider-value tabular-nums`},yt={class:`slider-track`},bt=[`disabled`],xt={class:`flex-1 overflow-auto relative`},St={key:0,class:`py-12 text-center`},Ct={key:1,class:`py-8 text-center`},wt={class:`text-fg-muted text-sm mb-2`},Tt={class:`flex items-center justify-center gap-2`},Et={key:2,class:`py-8 text-center text-fg-muted text-sm`},Dt=t({__name:`ViewerPanel`,props:{packageName:{},fromVersion:{},toVersion:{},file:{}},setup(e){let t=e,o=j(!0),c=j(.45),p=j(30),h=j(2),v=j(!1),b=j(!1),w=g(`optionsDropdownRef`);ee(w,()=>{b.value=!1});let{data:T,status:E,error:M}=R(_(()=>`/api/registry/compare-file/${t.packageName}/v/${t.fromVersion}...${t.toVersion}/${t.file.path}`),{query:_(()=>({mergeModifiedLines:String(o.value),maxChangeRatio:String(c.value),maxDiffDistance:String(p.value),inlineMaxCharEdits:String(h.value)})),timeout:15e3},`$U90D3AHmZ-`);function N(e,t,n){if(n===t)return 0;let r=(e-t)/(n-t)*100;return Math.min(100,Math.max(0,r))}function P(e,t,n){let r=[],i=t-e,a=Math.floor(i/n);if(a<=10)for(let e=1;e<=a;e++){let t=e*n/i*100;r.push(t)}return r}let I=_(()=>P(0,1,.1)),L=_(()=>P(1,60,10)),z=_(()=>[]),B=_(()=>N(c.value,0,1)),V=_(()=>N(p.value,1,60)),H=_(()=>N(h.value,0,10));function U(e){return e===void 0?``:e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function W(e){return`/package-code/${t.packageName}/v/${e}/${t.file.path}`}return(t,g)=>{let _=$e,j=F,N=Qe;return s(),k(`div`,et,[A(`div`,tt,[A(`div`,nt,[A(`span`,{class:n([`w-4 h-4 shrink-0`,e.file.type===`added`?`i-lucide:plus text-green-500`:e.file.type===`removed`?`i-lucide:minus text-red-500`:`i-lucide:pen text-yellow-500`])},null,2),A(`span`,rt,u(e.file.path),1),a(T)?.stats?(s(),k(S,{key:0},[a(T).stats.additions>0?(s(),k(`span`,it,` +`+u(a(T).stats.additions),1)):r(``,!0),a(T).stats.deletions>0?(s(),k(`span`,at,` -`+u(a(T).stats.deletions),1)):r(``,!0)],64)):r(``,!0),e.file.oldSize||e.file.newSize?(s(),k(`span`,ot,[e.file.type===`modified`?(s(),k(S,{key:0},[i(u(U(e.file.oldSize))+` → `+u(U(e.file.newSize)),1)],64)):e.file.type===`added`?(s(),k(S,{key:1},[i(u(U(e.file.newSize)),1)],64)):(s(),k(S,{key:2},[i(u(U(e.file.oldSize)),1)],64))])):r(``,!0)]),A(`div`,st,[A(`div`,{ref_key:`optionsDropdownRef`,ref:w,class:`relative`},[A(`button`,{type:`button`,class:n([`px-2 py-1 text-xs text-fg-muted hover:text-fg bg-bg-muted border border-border rounded transition-colors flex items-center gap-1.5`,{"bg-bg-elevated text-fg":a(b)}]),onClick:g[0]||=e=>b.value=!a(b)},[g[6]||=A(`span`,{class:`i-lucide:settings w-3.5 h-3.5`},null,-1),g[7]||=i(` Options `,-1),A(`span`,{class:n([`i-lucide:chevron-down w-3 h-3 transition-transform`,{"rotate-180":a(b)}])},null,2)],2),d(C,{"enter-active-class":`transition duration-150 ease-out motion-reduce:transition-none`,"enter-from-class":`opacity-0 scale-95 motion-reduce:scale-100`,"enter-to-class":`opacity-100 scale-100`,"leave-active-class":`transition duration-100 ease-in motion-reduce:transition-none`,"leave-from-class":`opacity-100 scale-100`,"leave-to-class":`opacity-0 scale-95 motion-reduce:scale-100`},{default:x(()=>[a(b)?(s(),k(`div`,{key:0,class:`absolute inset-ie-0 top-full mt-2 z-20 p-4 bg-bg-elevated border border-border rounded-xl shadow-2xl overflow-auto`,style:l({width:a(o)?`min(420px, calc(100vw - 24px))`:`min(320px, calc(100vw - 24px))`,maxWidth:`calc(100vw - 24px)`,maxHeight:`70vh`})},[A(`div`,ct,[d(_,{label:`Merge modified lines`,modelValue:a(o),"onUpdate:modelValue":g[1]||=e=>y(o)?o.value=e:null},null,8,[`modelValue`]),d(_,{label:`Word wrap`,modelValue:a(v),"onUpdate:modelValue":g[2]||=e=>y(v)?v.value=e:null},null,8,[`modelValue`]),A(`div`,{class:n([`flex flex-col gap-2 transition-opacity duration-150`,a(o)?`opacity-100`:`opacity-0`])},[g[11]||=A(`div`,{class:`sr-only`},[A(`label`,{for:`change-ratio`},`Change ratio`)],-1),A(`div`,{class:n([`slider-shell w-full min-w-0`,{"is-disabled":!a(o)}])},[A(`div`,lt,[g[8]||=A(`span`,{class:`slider-label`},`Change ratio`,-1),A(`span`,ut,u(a(c).toFixed(2)),1)]),A(`div`,dt,[(s(!0),k(S,null,m(a(I),e=>(s(),k(`div`,{key:`cr-${e}`,class:`slider-mark`,style:l({left:`calc(${e}% - 11px)`})},null,4))),128)),A(`div`,{class:`slider-range`,style:l({width:`${a(B)}%`})},null,4)]),O(A(`input`,{id:`change-ratio`,"onUpdate:modelValue":g[3]||=e=>y(c)?c.value=e:null,type:`range`,min:`0`,max:`1`,step:`0.01`,disabled:!a(o),class:`slider-input`},null,8,ft),[[D,a(c),void 0,{number:!0}]])],2),g[12]||=A(`div`,{class:`sr-only`},[A(`label`,{for:`diff-distance`},`Diff distance`)],-1),A(`div`,{class:n([`slider-shell w-full min-w-0`,{"is-disabled":!a(o)}])},[A(`div`,pt,[g[9]||=A(`span`,{class:`slider-label`},`Diff distance`,-1),A(`span`,mt,u(a(p)),1)]),A(`div`,ht,[(s(!0),k(S,null,m(a(L),e=>(s(),k(`div`,{key:`dd-${e}`,class:`slider-mark`,style:l({left:`calc(${e}% - 11px)`})},null,4))),128)),A(`div`,{class:`slider-range`,style:l({width:`${a(V)}%`})},null,4)]),O(A(`input`,{id:`diff-distance`,"onUpdate:modelValue":g[4]||=e=>y(p)?p.value=e:null,type:`range`,min:`1`,max:`60`,step:`1`,disabled:!a(o),class:`slider-input`},null,8,gt),[[D,a(p),void 0,{number:!0}]])],2),g[13]||=A(`div`,{class:`sr-only`},[A(`label`,{for:`char-edits`},`Char edits`)],-1),A(`div`,{class:n([`slider-shell w-full min-w-0`,{"is-disabled":!a(o)}])},[A(`div`,_t,[g[10]||=A(`span`,{class:`slider-label`},`Char edits`,-1),A(`span`,vt,u(a(h)),1)]),A(`div`,yt,[(s(!0),k(S,null,m(a(z),e=>(s(),k(`div`,{key:`ce-${e}`,class:`slider-mark`,style:l({left:`calc(${e}% - 11px)`})},null,4))),128)),A(`div`,{class:`slider-range`,style:l({width:`${a(H)}%`})},null,4)]),O(A(`input`,{id:`char-edits`,"onUpdate:modelValue":g[5]||=e=>y(h)?h.value=e:null,type:`range`,min:`0`,max:`10`,step:`1`,disabled:!a(o),class:`slider-input`},null,8,bt),[[D,a(h),void 0,{number:!0}]])],2)],2)])],4)):r(``,!0)]),_:1})],512),e.file.type===`removed`?r(``,!0):(s(),f(j,{key:0,to:W(e.toVersion),class:`px-2 py-1 text-xs text-fg-muted hover:text-fg bg-bg-muted border border-border rounded transition-colors`,target:`_blank`},{default:x(()=>[...g[14]||=[i(` View file `,-1)]]),_:1},8,[`to`]))])]),A(`div`,xt,[a(E)===`pending`?(s(),k(`div`,St,[...g[15]||=[A(`div`,{class:`i-svg-spinners-ring-resize w-6 h-6 mx-auto text-fg-muted`},null,-1),A(`p`,{class:`mt-2 text-sm text-fg-muted`},`Loading diff...`,-1)]])):a(E)===`error`?(s(),k(`div`,Ct,[g[17]||=A(`span`,{class:`i-lucide:triangle-alert w-8 h-8 mx-auto text-fg-subtle mb-2 block`},null,-1),A(`p`,wt,u(a(M)?.message||`Failed to load diff`),1),A(`div`,Tt,[e.file.type===`removed`?r(``,!0):(s(),f(j,{key:0,to:W(e.toVersion),class:`text-xs text-fg-muted hover:text-fg underline`},{default:x(()=>[...g[16]||=[i(` View in code browser `,-1)]]),_:1},8,[`to`]))])])):a(T)&&a(T).hunks.length===0?(s(),k(`div`,Et,` No content changes detected `)):a(T)?(s(),f(N,{key:3,hunks:a(T).hunks,type:a(T).type,"file-name":e.file.path,"word-wrap":a(v)},null,8,[`hunks`,`type`,`file-name`,`word-wrap`])):r(``,!0)])])}}}),Ot=Object.assign(V(Dt,[[`__scopeId`,`data-v-c6d08c92`]]),{__name:`DiffViewerPanel`}),kt={key:0,class:`md:hidden fixed inset-y-0 inset-is-0 z-50 w-72 max-w-[85vw] bg-bg-subtle border-ie border-border overflow-y-auto flex flex-col`},At={class:`sticky top-0 bg-bg-subtle border-b border-border px-4 py-3 flex items-center justify-between gap-2`},jt={class:`text-xs font-mono text-fg-muted flex items-center gap-2`},Mt={class:`flex items-center gap-1`},Nt={class:`text-green-500`},Pt={class:`text-red-500`},Ft={class:`text-yellow-500`},It=[`aria-label`],Lt=t({__name:`MobileSidebarDrawer`,props:c({compare:{},groupedDeps:{},allChanges:{}},{selectedFile:{default:null},selectedFileModifiers:{},fileFilter:{default:`all`},fileFilterModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:[`update:selectedFile`,`update:fileFilter`,`update:open`],setup(e){let t=e,n=T(e,`selectedFile`),i=T(e,`fileFilter`),a=T(e,`open`),o=L();w(()=>o.fullPath,()=>{a.value=!1});let c=B(document);return w(a,e=>{c.value=e}),(e,o)=>{let c=Q;return s(),k(S,null,[d(C,{"enter-active-class":`transition-opacity duration-200`,"enter-from-class":`opacity-0`,"enter-to-class":`opacity-100`,"leave-active-class":`transition-opacity duration-200`,"leave-from-class":`opacity-100`,"leave-to-class":`opacity-0`},{default:x(()=>[a.value?(s(),k(`div`,{key:0,class:`md:hidden fixed inset-0 z-40 bg-black/50`,onClick:o[0]||=e=>a.value=!1})):r(``,!0)]),_:1}),d(C,{"enter-active-class":`transition-transform duration-200`,"enter-from-class":`-translate-x-full`,"enter-to-class":`translate-x-0`,"leave-active-class":`transition-transform duration-200`,"leave-from-class":`translate-x-0`,"leave-to-class":`-translate-x-full`},{default:x(()=>[a.value?(s(),k(`aside`,kt,[A(`div`,At,[A(`div`,jt,[A(`span`,Mt,[A(`span`,Nt,`+`+u(t.compare.stats.filesAdded),1),o[4]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,Pt,`-`+u(t.compare.stats.filesRemoved),1),o[5]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,Ft,`~`+u(t.compare.stats.filesModified),1)]),o[6]||=A(`span`,{class:`text-fg-subtle`},`•`,-1),A(`span`,null,u(e.$t(`compare.files_count`,{count:t.allChanges.length})),1)]),A(`button`,{type:`button`,class:`text-fg-muted hover:text-fg transition-colors`,"aria-label":e.$t(`compare.close_files_panel`),onClick:o[1]||=e=>a.value=!1},[...o[7]||=[A(`span`,{class:`i-lucide:x w-5 h-5`},null,-1)]],8,It)]),d(c,{compare:t.compare,"grouped-deps":t.groupedDeps,"all-changes":t.allChanges,"selected-file":n.value,"onUpdate:selectedFile":o[2]||=e=>n.value=e,"file-filter":i.value,"onUpdate:fileFilter":o[3]||=e=>i.value=e},null,8,[`compare`,`grouped-deps`,`all-changes`,`selected-file`,`file-filter`])])):r(``,!0)]),_:1})],64)}}}),Rt=Object.assign(Lt,{__name:`DiffMobileSidebarDrawer`}),zt={class:`flex-1 flex flex-col min-h-0`},Bt={class:`border-b border-border bg-bg sticky top-14 z-20`},Vt={class:`container py-4`},Ht={class:`flex items-center gap-2 mb-3 flex-wrap min-w-0`},Ut={class:`flex items-center gap-3 flex-wrap`},Wt={class:`flex items-center gap-2`},Gt={key:1,class:`font-mono text-sm text-fg-muted`},Kt={class:`flex items-center gap-2`},qt={key:1,class:`font-mono text-sm text-fg-muted`},$={key:0,class:`container py-20 text-center`},Jt={key:1,class:`container py-20 text-center`},Yt={key:2,class:`container py-20 text-center`,role:`alert`},Xt={key:3,class:`flex-1 flex flex-col md:flex-row min-h-0 overflow-hidden`},Zt={class:`hidden md:flex w-80 border-ie border-border bg-bg-subtle flex-col shrink-0 min-h-0`},Qt={class:`flex-1 flex flex-col min-w-0 overflow-hidden`},$t={class:`md:hidden border-b border-border bg-bg-subtle px-4 py-3 flex items-center justify-between gap-3`},en={class:`flex items-center gap-2 text-2xs font-mono text-fg-muted`},tn={class:`flex items-center gap-1`},nn={class:`text-green-500`},rn={class:`text-red-500`},an={class:`text-yellow-500`},on={class:`flex-1 overflow-hidden bg-bg-subtle`},sn={key:1,class:`h-full flex items-center justify-center text-center p-8`},cn={class:`text-fg-muted`},ln=t({__name:`[versionRange]`,setup(e){let t=L(`diff`),n=_(()=>t.params.org?`${t.params.org}/${t.params.packageName}`:t.params.packageName),o=_(()=>{let e=t.params.versionRange.split(`...`);return e.length===2?{from:e[0],to:e[1]}:null}),c=_(()=>o.value?.from??``),l=_(()=>o.value?.to??``),p=M(),{data:m}=te(n),{data:g,status:v}=R(()=>`/api/registry/compare/${n.value}/v/${c.value}...${l.value}`,{immediate:!!o.value,timeout:15e3},`$GVvsdWq69c`),b=j(null),S=j(`all`),C=j(!1),T=_(()=>g.value?[...g.value.files.added,...g.value.files.removed,...g.value.files.modified].sort((e,t)=>e.path.localeCompare(t.path)):[]),E=_({get:()=>{if(b.value)return b.value;let e=t.query.file;return!e||!g.value?null:T.value.find(t=>t.path===e)??null},set:e=>{b.value=e}});w(E,e=>{let n={...t.query};e?.path?n.file=e.path:delete n.file,p.replace({query:n})},{deep:!1});let D=_(()=>{if(!g.value?.dependencyChanges)return new Map;let e=new Map;for(let t of g.value.dependencyChanges){let n=e.get(t.section)??[];n.push(t),e.set(t.section,n)}return e}),O=_(()=>p.resolve(H(n.value,`{version}`,l.value)).href),P=_(()=>p.resolve(H(n.value,c.value,`{version}`)).href);return N({title:()=>c.value&&l.value?`Compare ${n.value} ${c.value}...${l.value} - npmx`:`Compare - ${n.value} - npmx`,description:()=>`Compare changes between ${n.value} versions ${c.value} and ${l.value}`}),(e,t)=>{let p=F,_=ne,b=Q,w=Ot,j=Rt,M=I;return s(),k(`main`,zt,[A(`header`,Bt,[A(`div`,Vt,[A(`div`,Ht,[d(p,{to:a(U)(a(n)),class:`font-mono text-lg font-medium hover:text-fg transition-colors min-w-0 truncate`},{default:x(()=>[i(u(a(n)),1)]),_:1},8,[`to`]),t[7]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),t[8]||=A(`span`,{class:`font-mono text-sm text-fg-muted`},`compare`,-1)]),A(`div`,Ut,[A(`div`,Wt,[t[9]||=A(`span`,{class:`text-xs text-fg-subtle uppercase tracking-wide`},`From`,-1),a(m)?.versions&&a(m)?.[`dist-tags`]?(s(),f(_,{key:0,"package-name":a(n),"current-version":a(c),versions:a(m).versions,"dist-tags":a(m)[`dist-tags`],"url-pattern":a(O)},null,8,[`package-name`,`current-version`,`versions`,`dist-tags`,`url-pattern`])):(s(),k(`span`,Gt,u(a(c)),1))]),t[11]||=A(`span`,{class:`i-lucide:arrow-right w-4 h-4 text-fg-subtle`},null,-1),A(`div`,Kt,[t[10]||=A(`span`,{class:`text-xs text-fg-subtle uppercase tracking-wide`},`To`,-1),a(m)?.versions&&a(m)?.[`dist-tags`]?(s(),f(_,{key:0,"package-name":a(n),"current-version":a(l),versions:a(m).versions,"dist-tags":a(m)[`dist-tags`],"url-pattern":a(P)},null,8,[`package-name`,`current-version`,`versions`,`dist-tags`,`url-pattern`])):(s(),k(`span`,qt,u(a(l)),1))])])])]),a(o)?a(v)===`pending`?(s(),k(`div`,Jt,[...t[14]||=[A(`div`,{class:`i-svg-spinners-ring-resize w-8 h-8 mx-auto text-fg-muted`},null,-1),A(`p`,{class:`mt-4 text-fg-muted`},`Comparing versions...`,-1)]])):a(v)===`error`?(s(),k(`div`,Yt,[t[16]||=A(`p`,{class:`text-fg-muted mb-4`},`Failed to compare versions`,-1),d(p,{to:a(U)(a(n)),class:`btn`},{default:x(()=>[...t[15]||=[i(`Back to package`,-1)]]),_:1},8,[`to`])])):a(g)?(s(),k(`div`,Xt,[A(`aside`,Zt,[d(b,{compare:a(g),"grouped-deps":a(D),"all-changes":a(T),"selected-file":a(E),"onUpdate:selectedFile":t[0]||=e=>y(E)?E.value=e:null,"file-filter":a(S),"onUpdate:fileFilter":t[1]||=e=>y(S)?S.value=e:null,onFileSelect:t[2]||=e=>E.value=e},null,8,[`compare`,`grouped-deps`,`all-changes`,`selected-file`,`file-filter`])]),A(`div`,Qt,[A(`div`,$t,[A(`div`,en,[A(`span`,tn,[A(`span`,nn,`+`+u(a(g).stats.filesAdded),1),t[17]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,rn,`-`+u(a(g).stats.filesRemoved),1),t[18]||=A(`span`,{class:`text-fg-subtle`},`/`,-1),A(`span`,an,`~`+u(a(g).stats.filesModified),1)]),t[19]||=A(`span`,{class:`text-fg-subtle`},`•`,-1),A(`span`,null,u(e.$t(`compare.files_count`,{count:a(T).length})),1)]),A(`button`,{type:`button`,class:`px-2 py-1 inline-flex items-center gap-1.5 font-mono text-xs bg-bg-muted border border-border rounded text-fg-muted hover:text-fg hover:border-border-hover transition-colors`,onClick:t[3]||=e=>C.value=!0},[t[20]||=A(`span`,{class:`i-lucide:file-text w-3.5 h-3.5`},null,-1),i(` `+u(e.$t(`compare.files_button`)),1)])]),A(`div`,on,[a(E)?(s(),f(w,{key:0,"package-name":a(n),"from-version":a(c),"to-version":a(l),file:a(E)},null,8,[`package-name`,`from-version`,`to-version`,`file`])):(s(),k(`div`,sn,[A(`div`,null,[t[21]||=A(`span`,{class:`i-lucide:file-text w-16 h-16 mx-auto text-fg-subtle/50 block mb-4`},null,-1),A(`p`,cn,u(e.$t(`compare.select_file_prompt`)),1)])]))])])])):r(``,!0):(s(),k(`div`,$,[t[13]||=A(`p`,{class:`text-fg-muted mb-4`},` Invalid comparison URL. Use format: /diff/package/v/from...to `,-1),d(p,{to:a(U)(a(n)),class:`btn`},{default:x(()=>[...t[12]||=[i(`Go to package`,-1)]]),_:1},8,[`to`])])),d(M,null,{default:x(()=>[(s(),f(h,{to:`body`},[a(g)?(s(),f(j,{key:0,compare:a(g),"grouped-deps":a(D),"all-changes":a(T),"selected-file":a(E),"onUpdate:selectedFile":t[4]||=e=>y(E)?E.value=e:null,"file-filter":a(S),"onUpdate:fileFilter":t[5]||=e=>y(S)?S.value=e:null,open:a(C),"onUpdate:open":t[6]||=e=>y(C)?C.value=e:null},null,8,[`compare`,`grouped-deps`,`all-changes`,`selected-file`,`file-filter`,`open`])):r(``,!0)]))]),_:1})])}}});export{ln as default};