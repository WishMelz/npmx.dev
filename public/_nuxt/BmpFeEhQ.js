import{A as e,C as t,D as n,Dt as r,Et as i,J as a,Nt as o,O as s,S as c,St as l,b as u,ht as d,lt as f,m as p,ot as m,w as h,x as g}from"./BLt7TXlb.js";import{B as _,b as v,c as y,f as b,z as x}from"./CreLCcZP.js";import"./ByNgdIzL.js";import{d as S}from"./Cr_GQgS6.js";import"./B2KNUzwv.js";import"./BFu3gPrq.js";import{n as C}from"./DZubR30v.js";import{a as w}from"./mPlC9-cP.js";import{t as ee}from"./CPwDbSjG.js";import{n as T}from"./DkotcqDl.js";import"./Cend_Z8Q.js";import"./JOw9R0Rj.js";import{m as E}from"./Brdikwlz.js";import{t as D}from"./Cf-Ej6y2.js";import{n as O,t as k}from"./B_LT0yGC.js";import{t as te}from"./HQH6yG0Z.js";import{t as A}from"./CAwcA5eI.js";import{t as j}from"./Dg50IizM.js";import"./BDOMo5uf.js";import{t as M}from"./DDB7HE7E.js";var N={class:`flex flex-col sm:flex-row gap-3 mb-6`},P={class:`flex-1 relative`},F={for:`package-filter`,class:`sr-only`},I={key:0,class:`text-fg-subtle text-xs font-mono mb-4`},L=e({__name:`ListControls`,props:{filter:{},sort:{},placeholder:{},totalCount:{},filteredCount:{}},emits:[`update:filter`,`update:sort`],setup(e,{emit:n}){let{t:i}=C(),c=e,l=n,f=u({get:()=>c.filter,set:e=>l(`update:filter`,e)}),m=u({get:()=>c.sort,set:e=>l(`update:sort`,e)}),_=u(()=>[{value:`downloads`,label:i(`package.sort.downloads`)},{value:`updated`,label:i(`package.sort.published`)},{value:`name-asc`,label:i(`package.sort.name_asc`)},{value:`name-desc`,label:i(`package.sort.name_desc`)}]),v=u(()=>c.filter&&c.filteredCount!==void 0&&c.totalCount!==void 0&&c.filteredCount!==c.totalCount);return(n,c)=>{let l=E,u=A;return a(),h(p,null,[g(`div`,N,[g(`div`,P,[g(`label`,F,o(r(i)(`package.list.filter_label`)),1),c[2]||=g(`div`,{class:`absolute h-full w-10 flex items-center justify-center text-fg-subtle pointer-events-none`,"aria-hidden":`true`},[g(`div`,{class:`i-lucide:search w-4 h-4`})],-1),s(l,{id:`package-filter`,modelValue:r(f),"onUpdate:modelValue":c[0]||=e=>d(f)?f.value=e:null,type:`search`,placeholder:e.placeholder??r(i)(`package.list.filter_placeholder`),"no-correct":``,class:`w-full min-w-25 ps-10`,size:`medium`},null,8,[`modelValue`,`placeholder`])]),s(u,{label:r(i)(`package.list.sort_label`),"hidden-label":``,id:`package-sort`,class:`relative shrink-0`,modelValue:r(m),"onUpdate:modelValue":c[1]||=e=>d(m)?m.value=e:null,items:r(_).map(e=>({label:e.label,value:e.value}))},null,8,[`label`,`modelValue`,`items`])]),r(v)?(a(),h(`p`,I,o(r(i)(`package.list.showing_count`,{filtered:e.filteredCount,total:e.totalCount})),1)):t(``,!0)],64)}}}),ne=Object.assign(L,{__name:`PackageListControls`}),R=50,z=250;function B(e){let t=x(),{searchProvider:n}=w(),r=u(()=>T(t.query.p)===`npm`||n.value===`npm`?`npm`:`algolia`),{$npmRegistry:a}=S(),{searchByOwner:o}=k(),s=l(1),c=l(r.value),d=l(null),f=l(!1),p=y(()=>`user-packages:${r.value}:${i(e)}`,async({$npmRegistry:t},{signal:n})=>{let a=i(e);if(!a)return O();let l=r.value;if(l===`algolia`)try{let t=await o(a);if(a!==i(e)||l!==r.value)return O();if(t.objects.length>0)return c.value=`algolia`,d.value={username:a,objects:t.objects,total:t.total},t}catch{}c.value=`npm`,d.value=null,s.value=1;let u=new URLSearchParams;u.set(`text`,`maintainer:${a}`),u.set(`size`,String(R));let{data:f,isStale:p}=await t(`/-/v1/search?${u.toString()}`,{signal:n},60);return a!==i(e)||l!==r.value?O():(d.value={username:a,objects:f.objects,total:f.total},{...f,isStale:p})},{default:O});async function h(t=!0){let n=i(e);if(!n||c.value!==`npm`)return;if(d.value&&d.value.username!==n){d.value=null,await p.refresh();return}let r=d.value?.objects.length??0,o=Math.min(d.value?.total??1/0,z);if(!(r>=o)){t&&(f.value=!0);try{let t=r,s=Math.min(R,o-r),l=new URLSearchParams;l.set(`text`,`maintainer:${n}`),l.set(`size`,String(s)),l.set(`from`,String(t));let{data:u}=await a(`/-/v1/search?${l.toString()}`,{},60);if(n!==i(e)||c.value!==`npm`)return;if(d.value&&d.value.username===n){let e=new Set(d.value.objects.map(e=>e.package.name)),t=u.objects.filter(t=>!e.has(t.package.name));d.value={username:n,objects:[...d.value.objects,...t],total:u.total}}else d.value={username:n,objects:u.objects,total:u.total}}finally{t&&(f.value=!1)}}}async function g(){f.value||!b.value||(s.value++,await h())}async function _(){if(b.value){f.value=!0;try{for(;b.value;)await h(!1)}finally{f.value=!1}}}m(()=>r.value,e=>{d.value=null,s.value=1,c.value=e});let v=u(()=>{let t=i(e);return d.value&&d.value.username===t?{isStale:!1,objects:d.value.objects,total:d.value.total,time:new Date().toISOString()}:p.data.value}),b=u(()=>{if(!i(e)||c.value!==`npm`)return!1;if(!d.value)return!0;let t=d.value.objects.length;return t<d.value.total&&t<z});return{...p,data:v,isLoadingMore:f,hasMore:b,loadMore:g,loadAll:_,pageSize:R}}var V={class:`container flex-1 flex flex-col py-8 sm:py-12 w-full`},H={class:`mb-8 pb-8 border-b border-border`},U={class:`flex flex-wrap items-center gap-4`},W={class:`font-mono text-2xl sm:text-3xl font-medium`},G={key:0,class:`text-fg-muted text-sm mt-1`},K={class:`ms-auto text-end`},q={"aria-label":`External links`},J=[`href`,`title`],Y=[`title`],X={class:`font-mono`},re={key:1,role:`alert`,class:`py-12 text-center`},ie={class:`text-fg-muted mb-4`},ae={key:2},oe={class:`text-xs text-fg-subtle uppercase tracking-wider mb-4`},se={key:0,class:`text-fg-muted py-8 text-center font-mono`},ce={key:3,class:`flex-1 flex items-center justify-center`},le={class:`text-center`},ue={class:`text-fg-muted font-mono`},de={class:`text-fg`},fe={class:`text-fg-subtle text-sm mt-2`},Z=e({__name:`index`,setup(e){let i=x(`~username`),p=_(),y=u(()=>i.params.username.toLowerCase()),S=b(e=>{p.replace({query:{...i.query,page:e.page&&e.page>1?e.page:void 0,q:e.filter||void 0,sort:e.sort&&e.sort!==`downloads`?e.sort:void 0}})},300),C=l(T(i.query.q)),w=l(T(i.query.sort)||`downloads`),E=b((e,t)=>{S({filter:e,sort:t})},300);m([C,w],([e,t])=>{(e!==``||t!==`downloads`)&&I(),E(e,t)});let{data:O,status:k,error:A,isLoadingMore:N,hasMore:P,loadMore:F,loadAll:I,pageSize:L}=B(y),R=u(()=>{let e=Number.parseInt(T(i.query.page),10);return Number.isNaN(e)?1:Math.max(1,e)}),z=u(()=>O.value?.objects??[]),Z=u(()=>z.value.length),Q=u(()=>{let e=[...z.value];if(C.value){let t=C.value.toLowerCase();e=e.filter(e=>e.package.name.toLowerCase().includes(t)||e.package.description?.toLowerCase().includes(t))}switch(w.value){case`updated`:e.sort((e,t)=>{let n=e.package.date||``;return(t.package.date||``).localeCompare(n)});break;case`name-asc`:e.sort((e,t)=>e.package.name.localeCompare(t.package.name));break;case`name-desc`:e.sort((e,t)=>t.package.name.localeCompare(e.package.name));break;default:e.sort((e,t)=>(t.downloads?.weekly??0)-(e.downloads?.weekly??0));break}return e}),$=u(()=>Q.value.length),pe=u(()=>Q.value.reduce((e,t)=>e+(t.downloads?.weekly??0),0));function me(e){S({page:e,filter:C.value,sort:w.value})}return m(y,()=>{C.value=``,w.value=`downloads`}),v({title:()=>`~${y.value} - npmx`,ogTitle:()=>`~${y.value} - npmx`,twitterTitle:()=>`~${y.value} - npmx`,description:()=>`npm packages maintained by ${y.value}`,ogDescription:()=>`npm packages maintained by ${y.value}`,twitterDescription:()=>`npm packages maintained by ${y.value}`}),D(`Default`,{title:()=>`~${y.value}`,description:()=>O.value?`${O.value.total} packages`:`npm user profile`,primaryColor:`#60a5fa`}),(e,i)=>{let l=M,u=te,p=ee,m=ne,_=j;return a(),h(`main`,V,[g(`header`,H,[g(`div`,U,[s(l,{username:r(y)},null,8,[`username`]),g(`div`,null,[g(`h1`,W,`~`+o(r(y)),1),r(O)?.total?(a(),h(`p`,G,o(e.$t(`org.public_packages`,{count:e.$n(r(O).total)},r(O).total)),1)):t(``,!0)]),g(`div`,K,[g(`nav`,q,[g(`a`,{href:`https://www.npmjs.com/~${r(y)}`,target:`_blank`,rel:`noopener noreferrer`,class:`link-subtle font-mono text-sm inline-flex items-center gap-1.5`,title:e.$t(`common.view_on_npm`)},[...i[2]||=[g(`span`,{class:`i-simple-icons:npm w-4 h-4`,"aria-hidden":`true`},null,-1),n(` npm `,-1)]],8,J)]),g(`p`,{class:`text-fg-subtle text-xs mt-1 flex items-center gap-1.5 justify-end cursor-help`,title:e.$t(`common.vanity_downloads_hint`,{count:r($)},r($))},[i[3]||=g(`span`,{class:`i-lucide:chart-line w-3.5 h-3.5`,"aria-hidden":`true`},null,-1),g(`span`,X,o(e.$n(r(pe)))+` `+o(e.$t(`common.per_week`)),1)],8,Y)])])]),r(k)===`pending`&&r(z).length===0&&!r(A)?(a(),c(u,{key:0,text:e.$t(`common.loading_packages`)},null,8,[`text`])):r(A)||r(k)===`error`?(a(),h(`div`,re,[g(`p`,ie,o(r(A)?.message??e.$t(`user.page.failed_to_load`)),1),s(p,{variant:`button-secondary`,to:{name:`index`}},{default:f(()=>[n(o(e.$t(`common.go_back_home`)),1)]),_:1})])):r(z).length>0?(a(),h(`section`,ae,[g(`h2`,oe,o(e.$t(`user.page.packages_title`)),1),s(m,{filter:r(C),"onUpdate:filter":i[0]||=e=>d(C)?C.value=e:null,sort:r(w),"onUpdate:sort":i[1]||=e=>d(w)?w.value=e:null,placeholder:e.$t(`user.page.filter_placeholder`,{count:r(O)?.total??0}),"total-count":r(Z),"filtered-count":r($)},null,8,[`filter`,`sort`,`placeholder`,`total-count`,`filtered-count`]),r(Q).length===0?(a(),h(`p`,se,o(e.$t(`user.page.no_match`,{query:r(C)})),1)):(a(),c(_,{key:1,results:r(Q),"has-more":r(P),"is-loading":r(N),"page-size":r(L),"initial-page":r(R),onLoadMore:r(F),onPageChange:me},null,8,[`results`,`has-more`,`is-loading`,`page-size`,`initial-page`,`onLoadMore`]))])):r(k)===`success`?(a(),h(`div`,ce,[g(`div`,le,[g(`p`,ue,[n(o(e.$t(`user.page.no_packages`))+` `,1),g(`span`,de,`~`+o(r(y)),1)]),g(`p`,fe,o(e.$t(`user.page.no_packages_hint`)),1)])])):t(``,!0)])}}});export{Z as default};