import{A as e,At as t,C as n,D as r,Dt as i,J as a,Nt as o,O as s,S as c,St as l,Z as u,at as d,b as f,lt as p,m,n as h,ot as g,p as _,w as v,x as y,yt as ee,z as b}from"./BLt7TXlb.js";import{R as te,t as ne}from"./CreLCcZP.js";import{t as re}from"./-B2-_an5.js";import{f as ie}from"./Brdikwlz.js";import{r as x,t as ae}from"./B5EGaAMl.js";import{c as oe,l as S,o as C,r as w,s as T}from"./DtKNaDAW.js";var se=x(),ce=[`aria-expanded`],le={dir:`ltr`},E={key:0,class:`text-xs px-1.5 py-0.5 rounded badge-green font-sans font-medium`},D=[`aria-activedescendant`],O=[`id`,`aria-selected`,`data-focused`],k=[`aria-expanded`,`aria-label`,`onClick`],A={key:0,class:`i-svg-spinners:ring-resize w-3 h-3`,"aria-hidden":`true`},j={key:1,class:`w-4`},M={dir:`ltr`},N={key:2,class:`flex items-center gap-1 shrink-0`},P={key:0,class:`ms-6 border-is border-border`},F={class:`truncate`,dir:`ltr`},I={key:0,class:`flex items-center gap-1 shrink-0`},L={class:`border-t border-border mt-1 pt-1 px-3 py-2`},R=e({__name:`VersionSelector`,props:{packageName:{},currentVersion:{},versions:{},distTags:{},urlPattern:{}},setup(e){let x=e,R=l(!1),z=d(`dropdownRef`),B=d(`listboxRef`),V=l(-1);re(z,()=>{R.value=!1});let H=ee([]),U=l(!1),W=l(!1),G=l(null),ue=f(()=>x.distTags.latest),K=f(()=>w(x.distTags));function q(e){return x.urlPattern.replace(`{version}`,e)}function J(e,t){try{return(0,se.compare)(e,t)}catch{return e.localeCompare(t)}}function Y(){let e=[],t=new Set,n=new Map;for(let[e,t]of Object.entries(x.distTags)){let r=n.get(t);r?r.tags.push(e):n.set(t,{tags:[e]})}for(let e of n.values())e.tags.sort((e,t)=>e===`latest`?-1:t===`latest`?1:e.localeCompare(t));let r=Array.from(n.entries()).sort((e,t)=>J(t[0],e[0]));for(let[n,{tags:i}]of r){t.add(n);let r=i[0];e.push({id:`tag:${r}`,label:r,primaryVersion:{version:n,tags:i,isCurrent:n===x.currentVersion},versions:[],isExpanded:!1,isLoading:!1})}return e}H.value=Y();async function de(){if(G.value)return G.value;W.value=!0;try{let e=await ae(x.packageName);return G.value=e,U.value=!0,e}finally{W.value=!1}}function X(e){let t=[],n=new Set;for(let[r,i]of Object.entries(x.distTags)){let a=t.find(e=>e.primaryVersion.version===i);if(a){a.primaryVersion.tags?.includes(r)||(a.primaryVersion.tags=[...a.primaryVersion.tags??[],r],a.primaryVersion.tags.sort((e,t)=>e===`latest`?-1:t===`latest`?1:e.localeCompare(t)),a.label=a.primaryVersion.tags[0],a.id=`tag:${a.label}`);continue}let o=C(i),s=e.filter(e=>{let t=C(e.version);return S(e.version,i)&&t===o}).sort((e,t)=>J(t.version,e.version)).map(e=>({version:e.version,tags:K.value.get(e.version),isCurrent:e.version===x.currentVersion}));for(let e of s)n.add(e.version);t.push({id:`tag:${r}`,label:r,primaryVersion:{version:i,tags:K.value.get(i),isCurrent:i===x.currentVersion},versions:s,isExpanded:!1,isLoading:!1})}t.sort((e,t)=>J(t.primaryVersion.version,e.primaryVersion.version));let r=[];for(let e of t){let t=r.find(t=>t.primaryVersion.version===e.primaryVersion.version);if(t){let n=[...t.primaryVersion.tags??[],...e.primaryVersion.tags??[]],r=[...new Set(n)].sort((e,t)=>e===`latest`?-1:t===`latest`?1:e.localeCompare(t));t.primaryVersion.tags=r,t.label=r[0],t.id=`tag:${t.label}`}else r.push(e)}let i=new Map;for(let t of e){if(n.has(t.version))continue;let e=T(t.version);i.has(e)||i.set(e,[]),i.get(e).push({version:t.version,tags:K.value.get(t.version),isCurrent:t.version===x.currentVersion})}let a=Array.from(i.keys()).sort((e,t)=>{let[n,r]=e.split(`.`).map(Number),[i,a]=t.split(`.`).map(Number);return n===i?(a??-1)-(r??-1):(i??0)-(n??0)});for(let e of a){let t=i.get(e);t.sort((e,t)=>J(t.version,e.version));let n=t[0];n&&r.push({id:`group:${e}`,label:oe(e),primaryVersion:n,versions:t,isExpanded:!1,isLoading:!1})}H.value=r}async function Z(e){let t=H.value.find(t=>t.id===e);if(t){if(t.isExpanded){t.isExpanded=!1;return}if(U.value)t.isExpanded=!0;else{t.isLoading=!0;try{X(await de());let t=H.value.find(t=>t.id===e);t&&(t.isExpanded=!0)}catch(e){console.error(`Failed to load versions:`,e)}finally{t.isLoading=!1}}}}let Q=f(()=>{let e=[];for(let t of H.value)if(e.push({type:`group`,groupId:t.id,version:t.primaryVersion}),t.isExpanded&&t.versions.length>1)for(let n of t.versions.slice(1))e.push({type:`version`,groupId:t.id,version:n});return e});function fe(e){e.key===`Escape`?R.value=!1:e.key===`ArrowDown`&&!R.value&&(e.preventDefault(),R.value=!0,V.value=0)}function pe(e){let t=Q.value;switch(e.key){case`Escape`:R.value=!1;break;case`ArrowDown`:e.preventDefault(),V.value=Math.min(V.value+1,t.length-1),$();break;case`ArrowUp`:e.preventDefault(),V.value=Math.max(V.value-1,0),$();break;case`Home`:e.preventDefault(),V.value=0,$();break;case`End`:e.preventDefault(),V.value=t.length-1,$();break;case`ArrowRight`:{e.preventDefault();let n=t[V.value];if(n?.type===`group`){let e=H.value.find(e=>e.id===n.groupId);e&&!e.isExpanded&&e.versions.length>1&&Z(n.groupId)}break}case`ArrowLeft`:{e.preventDefault();let n=t[V.value];if(n?.type===`group`){let e=H.value.find(e=>e.id===n.groupId);e?.isExpanded&&(e.isExpanded=!1)}else if(n?.type===`version`){let e=t.findIndex(e=>e.type===`group`&&e.groupId===n.groupId);e>=0&&(V.value=e,$())}break}case`Enter`:case` `:if(e.preventDefault(),V.value>=0&&V.value<t.length){let e=t[V.value];e?.version&&me(e.version.version)}break}}function $(){b(()=>{(B.value?.querySelector(`[data-focused="true"]`))?.scrollIntoView({block:`nearest`})})}function me(e){R.value=!1,te(q(e))}return g(R,e=>{if(e){let e=Q.value.findIndex(e=>e.version?.isCurrent);V.value=e>=0?e:0}}),g(()=>[x.distTags,x.versions,x.currentVersion],()=>{U.value&&G.value?X(G.value):H.value=Y()}),(l,d)=>{let f=ne;return a(),v(`div`,{ref_key:`dropdownRef`,ref:z,class:`relative`},[y(`button`,{type:`button`,"aria-haspopup":`listbox`,"aria-expanded":i(R),class:`flex items-center gap-1.5 text-fg-subtle font-mono text-sm hover:text-fg transition-[color] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-bg rounded`,onClick:d[0]||=e=>R.value=!i(R),onKeydown:fe},[y(`span`,le,o(e.currentVersion),1),e.currentVersion===i(ue)?(a(),v(`span`,E,` latest `)):n(``,!0),y(`span`,{class:t([`i-lucide:chevron-down w-3.5 h-3.5 transition-[transform] duration-200 motion-reduce:transition-none`,{"rotate-180":i(R)}]),"aria-hidden":`true`},null,2)],40,ce),s(h,{"enter-active-class":`transition-[opacity,transform] duration-150 ease-out motion-reduce:transition-none`,"enter-from-class":`opacity-0 scale-95`,"enter-to-class":`opacity-100 scale-100`,"leave-active-class":`transition-[opacity,transform] duration-100 ease-in motion-reduce:transition-none`,"leave-from-class":`opacity-100 scale-100`,"leave-to-class":`opacity-0 scale-95`},{default:p(()=>[i(R)?(a(),v(`div`,{key:0,ref_key:`listboxRef`,ref:B,role:`listbox`,tabindex:`0`,"aria-activedescendant":i(V)>=0?`version-${i(Q)[i(V)]?.version?.version}`:void 0,class:`absolute top-full inset-is-0 mt-2 min-w-[220px] bg-bg-subtle/80 backdrop-blur-sm border border-border-subtle rounded-lg shadow-lg shadow-fg-subtle/10 z-50 py-1 max-h-[400px] overflow-y-auto overscroll-contain focus-visible:outline-none`,onKeydown:pe},[(a(!0),v(m,null,u(i(H),e=>(a(),v(`div`,{key:e.id},[y(`div`,{id:`version-${e.primaryVersion.version}`,role:`option`,"aria-selected":e.primaryVersion.isCurrent,"data-focused":i(Q)[i(V)]?.groupId===e.id&&i(Q)[i(V)]?.type===`group`,class:t([`flex items-center gap-2 px-3 py-2 text-sm font-mono hover:bg-bg-muted transition-[color,background-color] focus-visible:outline-none`,[e.primaryVersion.isCurrent?`text-fg bg-bg-muted`:`text-fg-muted`,i(Q)[i(V)]?.groupId===e.id&&i(Q)[i(V)]?.type===`group`?`bg-bg-muted`:``]])},[e.versions.length>1||!i(U)?(a(),v(`button`,{key:0,type:`button`,class:`w-4 h-4 flex items-center justify-center text-fg-subtle hover:text-fg transition-colors shrink-0`,"aria-expanded":e.isExpanded,"aria-label":e.isExpanded?`Collapse`:`Expand`,onClick:_(t=>Z(e.id),[`stop`])},[e.isLoading?(a(),v(`span`,A)):(a(),v(`span`,{key:1,class:t([`w-3 h-3 transition-transform duration-200 rtl-flip`,e.isExpanded?`i-lucide:chevron-down`:`i-lucide:chevron-right`]),"aria-hidden":`true`},null,2))],8,k)):(a(),v(`span`,j)),s(f,{to:q(e.primaryVersion.version),class:`flex-1 truncate hover:text-fg transition-colors`,onClick:d[1]||=e=>R.value=!1},{default:p(()=>[y(`span`,M,o(e.primaryVersion.version),1)]),_:2},1032,[`to`]),e.primaryVersion.tags?.length?(a(),v(`span`,N,[(a(!0),v(m,null,u(e.primaryVersion.tags,e=>(a(),v(`span`,{key:e,class:t([`text-xs px-1.5 py-0.5 rounded font-sans font-medium`,e===`latest`?`badge-green`:`badge-subtle`])},o(e),3))),128))])):n(``,!0)],10,O),e.isExpanded&&e.versions.length>1?(a(),v(`div`,P,[(a(!0),v(m,null,u(e.versions.slice(1),r=>(a(),c(f,{key:r.version,id:`version-${r.version}`,to:q(r.version),role:`option`,"aria-selected":r.isCurrent,"data-focused":i(Q)[i(V)]?.groupId===e.id&&i(Q)[i(V)]?.type===`version`&&i(Q)[i(V)]?.version?.version===r.version,class:t([`flex items-center justify-between gap-2 ps-4 pe-3 py-1.5 text-xs font-mono hover:bg-bg-muted transition-[color,background-color] focus-visible:outline-none`,[r.isCurrent?`text-fg bg-bg-muted`:`text-fg-subtle`,i(Q)[i(V)]?.version?.version===r.version?`bg-bg-muted`:``]]),onClick:d[2]||=e=>R.value=!1},{default:p(()=>[y(`span`,F,o(r.version),1),r.tags?.length?(a(),v(`span`,I,[(a(!0),v(m,null,u(r.tags,e=>(a(),v(`span`,{key:e,class:t([`text-4xs px-1 py-0.5 rounded font-sans font-medium`,e===`latest`?`bg-emerald-500/10 text-emerald-400`:`bg-bg-muted text-fg-subtle`])},o(e),3))),128))])):n(``,!0)]),_:2},1032,[`id`,`to`,`aria-selected`,`data-focused`,`class`]))),128))])):n(``,!0)]))),128)),y(`div`,L,[s(f,{to:(`packageRoute`in l?l.packageRoute:i(ie))(e.packageName),class:`text-xs text-fg-subtle hover:text-fg transition-[color] focus-visible:outline-none focus-visible:text-fg`,onClick:d[3]||=e=>R.value=!1},{default:p(()=>[r(o(l.$t(`package.versions.view_all`,{count:Object.keys(e.versions).length},Object.keys(e.versions).length)),1)]),_:1},8,[`to`])])],40,D)):n(``,!0)]),_:1})],512)}}}),z=Object.assign(R,{__name:`VersionSelector`});export{z as t};