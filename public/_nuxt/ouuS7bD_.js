import{At as e,C as t,Dt as n,G as r,H as i,J as a,Mt as o,Nt as s,O as c,Z as l,b as u,m as d,ot as f,p,u as ee,ut as te,w as m,x as h,yt as g,z as ne}from"./BLt7TXlb.js";import{Mt as re,Nt as _,bt as v,j as ie}from"./Cf-0F-2c.js";import{t as y}from"./CWNsAIol.js";import{t as b}from"./xh7dz5-d.js";import{t as ae}from"./C66xQW7K.js";var oe=[`disabled`],se=[`data-mode`,`xmlns`,`viewBox`],ce=[`cx`,`cy`,`r`,`fill`],le=[`x1`,`y1`,`x2`,`y2`,`stroke`,`stroke-width`],ue=[`x1`,`y1`,`x2`,`y2`,`stroke`,`stroke-width`,`marker-end`],de=[`d`,`stroke`,`stroke-width`],fe=[`x`,`y`,`fill`,`font-size`],pe=[`x`,`dy`],me=[`d`,`stroke`,`stroke-width`],x=y({__name:`NonSvgPenAndPaper`,props:{parent:{type:HTMLElement},backgroundColor:{type:String,default:`#FFFFFF`},color:{type:String,default:`#2D353C`},active:{type:Boolean,default:!1},isCursorPointer:{type:Boolean,default:!1}},emits:[`close`],setup(y,{emit:x}){let S=y,he=x,C=g([]),w=g([]),ge=g(`0 0 0 0`),T=g(S.color),E=g(1),D=g(null),O=g(!1),k=g(null),A=g({x:0,y:0}),j=g([``]),M=g({row:0,col:0}),N=g(16),_e=1,ve=[`arrow`,`text`,`line`,`draw`],P=g(0),F=u(()=>ve[P.value]),I=g(null);g(null),g(null);let L=g(`arrow-${_()}`),R=g(`arrow-def-${_()}`),ye={arrow:`plotArrow`,text:`text`,line:`plotLine`,draw:`annotator`};function be(){P.value+1>=ve.length?P.value=0:P.value+=1}function z(){return _e++}function xe(e){let t=Y.value;if(!t)return{x:0,y:0};let n=t.createSVGPoint(),r=e.touches?.length||e.changedTouches?.length?e.touches?.[0]||e.changedTouches?.[0]:null,i=r?r.clientX:e.clientX,a=r?r.clientY:e.clientY;n.x=i,n.y=a;let o=t.getScreenCTM()?.inverse();return o?n.matrixTransform(o):{x:0,y:0}}function B(e){if(!D.value||F.value!==`text`||O.value)return;let{x:t,y:n}=xe(e);A.value={x:t,y:n},j.value=[``],M.value={row:0,col:0};let r=document.createElementNS(`http://www.w3.org/2000/svg`,`text`);r.setAttribute(`x`,t),r.setAttribute(`y`,n),r.setAttribute(`fill`,T.value),r.setAttribute(`font-size`,N.value),r.setAttribute(`font-family`,`sans-serif`),r.setAttribute(`class`,`vue-data-ui-doodle`),r.setAttribute(`dominant-baseline`,`hanging`),r.setAttribute(`pointer-events`,`all`);let i=document.createElementNS(`http://www.w3.org/2000/svg`,`tspan`);i.setAttribute(`x`,t),i.setAttribute(`dy`,`0`),i.textContent=``,r.appendChild(i),r.style.pointerEvents=`none`,r.style.userSelect=`none`,D.value.appendChild(r),k.value=r,O.value=!0,window.addEventListener(`keydown`,V),window.addEventListener(`mousedown`,Se,!0),H(),U()}function V(e){if(!O.value)return;let{row:t,col:n}=M.value,r=j.value.slice(),i=!1;if(e.key===`Enter`){let a=r[t],o=a.slice(0,n),s=a.slice(n);r.splice(t,1,o,s),t+=1,n=0,i=!0,e.preventDefault()}else if(e.key===`Backspace`){if(n>0)r[t]=r[t].slice(0,n-1)+r[t].slice(n),--n,i=!0;else if(t>0){let e=r[t-1].length;r[t-1]+=r[t],r.splice(t,1),--t,n=e,i=!0}e.preventDefault()}else if(e.key===`Delete`)n<r[t].length?(r[t]=r[t].slice(0,n)+r[t].slice(n+1),i=!0):t<r.length-1&&(r[t]+=r[t+1],r.splice(t+1,1),i=!0),e.preventDefault();else if(e.key===`ArrowLeft`)n>0?--n:t>0&&(--t,n=r[t].length),i=!0,e.preventDefault();else if(e.key===`ArrowRight`)n<r[t].length?n+=1:t<r.length-1&&(t+=1,n=0),i=!0,e.preventDefault();else if(e.key===`ArrowUp`)t>0&&(--t,n=Math.min(n,r[t].length),i=!0),e.preventDefault();else if(e.key===`ArrowDown`)t<r.length-1&&(t+=1,n=Math.min(n,r[t].length),i=!0),e.preventDefault();else if(e.key.length===1&&!e.ctrlKey&&!e.metaKey&&!e.altKey)r[t]=r[t].slice(0,n)+e.key+r[t].slice(n),n+=1,i=!0,e.preventDefault();else if(e.key===`Escape`){Ce(!0);return}else e.key===`Tab`&&e.preventDefault();i&&(j.value=r,M.value={row:t,col:n},H(),U())}function H(){let e=k.value,{x:t,y:n}=A.value;for(;e.firstChild;)e.removeChild(e.firstChild);j.value.forEach((n,r)=>{let i=document.createElementNS(`http://www.w3.org/2000/svg`,`tspan`);i.setAttribute(`x`,t),i.setAttribute(`dy`,r===0?`0`:`${N.value*1.2}`),i.textContent=n.length?n:`窶義,e.appendChild(i)})}function U(){let e=D.value.querySelector(`.vue-data-ui-svg-caret`);e&&D.value.removeChild(e);let t=k.value;if(!t)return;let{x:n,y:r}=A.value,{row:i,col:a}=M.value,o=N.value,s=t.childNodes[i];if(!s)return;let c=s.textContent.slice(0,a);c.endsWith(` `)&&(c+=`\xA0`);let l=document.createElementNS(`http://www.w3.org/2000/svg`,`text`);l.setAttribute(`x`,n),l.setAttribute(`y`,r),l.setAttribute(`font-size`,o),l.setAttribute(`font-family`,`sans-serif`),l.textContent=c||``,D.value.appendChild(l);let u=l.getBBox();D.value.removeChild(l);let d=r+i*o*1.2,f=n+u.width,p=document.createElementNS(`http://www.w3.org/2000/svg`,`rect`);p.setAttribute(`x`,f),p.setAttribute(`y`,d),p.setAttribute(`width`,1),p.setAttribute(`height`,o),p.setAttribute(`fill`,T.value),p.setAttribute(`class`,`vue-data-ui-svg-caret`),D.value.appendChild(p)}function Se(e){if(k.value&&!k.value.contains(e.target)){let e=k.value.children;e.length===1&&(e[0].textContent===``||e[0].textContent===`窶義)&&k.value.remove(),Ce(!1)}}function Ce(e=!1){window.removeEventListener(`keydown`,V),window.removeEventListener(`mousedown`,Se,!0);let t=D.value?.querySelector(`.vue-data-ui-svg-caret`);t&&D.value.removeChild(t);let n=j.value.every(e=>!e||e===`窶義);e||n||C.value.push({id:z(),type:`text`,x:A.value.x,y:A.value.y,color:T.value,fontSize:N.value,lines:j.value.map(e=>e)}),k.value&&D.value&&D.value.contains(k.value)&&D.value.removeChild(k.value),O.value=!1,k.value=null,j.value=[``],M.value={row:0,col:0}}let W=u(()=>ie(S.color,.6));function G({width:e,height:t}){ge.value=`0 0 ${e} ${t}`}let K=g(null);r(()=>{ne(()=>{if(S.parent){K.value=new ResizeObserver(e=>{for(let t of e){let{width:e,height:n}=t.contentRect;G({width:e,height:n})}}),K.value.observe(S.parent);let{width:e,height:t}=S.parent.getBoundingClientRect();G({width:e,height:t})}}),D.value=Y.value.querySelector(`g`)}),i(()=>{K.value&&K.value.disconnect()}),f(()=>S.parent,e=>{if(!e)return;let{width:t,height:n}=S.parent.getBoundingClientRect();G({width:t,height:n})},{immediate:!0}),f(F,e=>{Y.value&&(Y.value.removeEventListener(`mousedown`,B),Y.value.removeEventListener(`touchstart`,B),e===`text`&&(Y.value.addEventListener(`mousedown`,B),Y.value.addEventListener(`touchstart`,B,{passive:!1})))});let q=g(!1),J=g(``),Y=g(null),X=g(!1),we=g(null);f(()=>S.active,e=>{Y.value&&(Y.value.style.touchAction=e?`none`:``)},{immediate:!0});function Te(e){if(e.cancelable&&e.preventDefault(),F.value!==`draw`||!Y.value)return;q.value=!0;let{x:t,y:n}=$(e);J.value=`M ${t} ${n}`}function Ee(e){if(e.cancelable&&e.preventDefault(),F.value!==`draw`||!q.value||!Y.value)return;let{x:t,y:n}=$(e);J.value+=` ${t} ${n}`}function De(){let e=Y.value;if(!e)return;let t=e.querySelector(`defs#${R.value}`);if(t||(t=document.createElementNS(`http://www.w3.org/2000/svg`,`defs`),t.setAttribute(`id`,R.value),e.appendChild(t)),t.querySelector(`#${L.value}`))return;let n=document.createElementNS(v,`marker`);n.setAttribute(`id`,L.value),n.setAttribute(`markerUnits`,`strokeWidth`),n.setAttribute(`markerWidth`,`6`),n.setAttribute(`markerHeight`,`6`),n.setAttribute(`refX`,`4`),n.setAttribute(`refY`,`3`),n.setAttribute(`orient`,`auto`),n.setAttribute(`viewBox`,`0 0 6 6`);let r=document.createElementNS(v,`path`);r.setAttribute(`d`,`M 0 0 L 6 ${6/2} L 0 6 z`),r.setAttribute(`fill`,`context-stroke`),r.setAttribute(`stroke`,`none`),n.appendChild(r),t.appendChild(n)}function Oe(e){if(e.cancelable&&e.preventDefault(),![`line`,`arrow`].includes(F.value)||!Y.value||!D.value)return;F.value===`arrow`&&De(),X.value=!0;let{x:t,y:n}=$(e);we.value={x:t,y:n},I.value=document.createElementNS(v,`line`),I.value.setAttribute(`x1`,t),I.value.setAttribute(`y1`,n),I.value.setAttribute(`x2`,t),I.value.setAttribute(`y2`,n),I.value.setAttribute(`stroke`,T.value),I.value.setAttribute(`stroke-width`,E.value),I.value.setAttribute(`stroke-linecap`,`round`),I.value.setAttribute(`class`,`vue-data-ui-doodle`),F.value===`arrow`&&I.value.setAttribute(`marker-end`,`url(#${L.value})`),D.value.appendChild(I.value)}function ke(e){if(e.cancelable&&e.preventDefault(),![`line`,`arrow`].includes(F.value)||!X.value||!I.value)return;let{x:t,y:n}=$(e);I.value.setAttribute(`x2`,t),I.value.setAttribute(`y2`,n)}function Z(e){if(e?.cancelable&&e.preventDefault(),!X.value||!I.value)return;let{x:t,y:n}=$(e);I.value.setAttribute(`x2`,t),I.value.setAttribute(`y2`,n),C.value.push({id:z(),type:F.value,x1:parseFloat(I.value.getAttribute(`x1`)),y1:parseFloat(I.value.getAttribute(`y1`)),x2:t,y2:n,strokeWidth:E.value,color:T.value}),w.value=[],D.value.contains(I.value)&&D.value.removeChild(I.value),I.value=null,we.value=null,X.value=!1}function Ae(e){let t=e.trim().split(/\s+/);if(t.length<4)return e;let n=t.slice(1).map(Number);if(n.length%2!=0)return e;let r=je(n),i=[`M ${r[0]} ${r[1]}`];for(let e=2;e<r.length-2;e+=2){let t=r[e-2],n=r[e-1],a=r[e],o=r[e+1],s=(t+a)/2,c=(n+o)/2;i.push(`Q ${t} ${n} ${s} ${c}`)}let a=r[r.length-2],o=r[r.length-1];return i.push(`L ${a} ${o}`),i.join(` `)}function je(e,t=1){let n=[...e];for(let r=2;r<e.length-2;r+=2){let i=e[r],a=e[r+1],o=e[r-2],s=e[r-1],c=e[r+2],l=e[r+3];n[r]=i+t*((o+c)/2-i),n[r+1]=a+t*((s+l)/2-a)}return n}function Me(e){let t=e.trim().split(/\s+/),n=``,r=``,i=null,a=null;for(let e=0;e<t.length;e+=1){let o=t[e];if(isNaN(o)){if(r=o,r===`M`||r===`L`)i=parseFloat(t[++e]),a=parseFloat(t[++e]),n+=`${r}${i} ${a}`;else if(r===`Q`){let r=parseFloat(t[++e]),o=parseFloat(t[++e]),s=parseFloat(t[++e]),c=parseFloat(t[++e]);r===i&&o===a?n+=`t${s-i} ${c-a}`:n+=`q${r-i} ${o-a} ${s-i} ${c-a}`,i=s,a=c}}else{let s=parseFloat(o),c=parseFloat(t[++e]);if(r===`L`){let e=s-i,t=c-a;e===0?n+=`v${t}`:t===0?n+=`h${e}`:n+=`l${e} ${t}`,i=s,a=c}else if(r===`Q`){let r=s,o=c,l=parseFloat(t[++e]),u=parseFloat(t[++e]);r===i&&o===a?n+=`t${l-i} ${u-a}`:n+=`q${r-i} ${o-a} ${l-i} ${u-a}`,i=l,a=u}}}return n}function Q(e){e?.cancelable&&e.preventDefault(),F.value===`draw`&&(q.value&&(C.value.push({id:z(),strokeWidth:E.value,path:Me(Ae(J.value)),color:T.value}),w.value=[],J.value=``),q.value=!1)}function $(e){if(!Y.value)return{x:0,y:0};let t=Y.value.getBoundingClientRect(),n=e.touches?.length||e.changedTouches?.length?e.touches?.[0]||e.changedTouches?.[0]:null,r=n?n.clientX:e.clientX,i=n?n.clientY:e.clientY;return{x:r-t.left,y:i-t.top}}function Ne(){if(C.value.length>0){let e=C.value.pop();w.value.push(e)}}function Pe(){if(w.value.length>0){let e=w.value.pop();C.value.push(e)}}function Fe(){C.value=[],w.value=[]}let Ie=g(null);return(r,i)=>(a(),m(d,null,[y.active?(a(),m(`div`,{key:0,"data-dom-to-png-ignore":``,class:e({"vue-ui-pen-and-paper-actions":!0,visible:y.active}),style:o({backgroundColor:y.backgroundColor})},[h(`button`,{class:`vue-ui-pen-and-paper-action`,style:o({backgroundColor:y.backgroundColor,border:`1px solid ${W.value}`,cursor:y.isCursorPointer?`pointer`:`default`}),onClick:i[0]||=e=>he(`close`)},[c(b,{name:`close`,stroke:y.color},null,8,[`stroke`])],4),h(`button`,{class:e({"vue-ui-pen-and-paper-action":!0}),style:o({padding:`0 !important`,cursor:y.isCursorPointer?`pointer`:`default`})},[c(ae,{value:T.value,"onUpdate:value":i[1]||=e=>T.value=e,backgroundColor:y.backgroundColor,buttonBorderColor:W.value},null,8,[`value`,`backgroundColor`,`buttonBorderColor`])],4),h(`button`,{class:e([`vue-ui-pen-and-paper-action`,{"vue-ui-pen-and-paper-action-active":F.value===`text`}]),onClick:i[2]||=e=>be(),style:o({backgroundColor:y.backgroundColor,border:`1px solid ${W.value}`,cursor:y.isCursorPointer?`pointer`:`default`})},[c(b,{name:ye[F.value],stroke:y.color},null,8,[`name`,`stroke`]),h(`div`,{style:o({position:`absolute`,bottom:`-20px`,color:W.value,width:`100%`,textAlign:`center`,fontSize:`12px`})},s(n(re)({v:F.value===`text`?N.value:E.value,s:`px`,r:1})),5)],6),h(`button`,{class:e({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!C.value.length}),disabled:!C.value.length,style:o({backgroundColor:y.backgroundColor,border:`1px solid ${W.value}`,marginTop:`20px`,cursor:y.isCursorPointer?`pointer`:`default`}),onClick:Ne},[c(b,{name:`refresh`,stroke:y.color},null,8,[`stroke`])],14,oe),h(`button`,{class:e({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!w.value.length}),style:o({backgroundColor:y.backgroundColor,border:`1px solid ${W.value}`,cursor:y.isCursorPointer?`pointer`:`default`}),onClick:Pe},[c(b,{name:`refresh`,stroke:y.color,style:{transform:`scaleX(-1)`}},null,8,[`stroke`])],6),h(`button`,{class:e([{"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!C.value.length},`vue-ui-pen-and-paper-action`]),style:o({backgroundColor:y.backgroundColor,border:`1px solid ${W.value}`,cursor:y.isCursorPointer?`pointer`:`default`}),onClick:Fe},[c(b,{name:`trash`,stroke:y.color},null,8,[`stroke`])],6),F.value===`draw`?te((a(),m(`input`,{key:0,ref_key:`range`,ref:Ie,type:`range`,class:`vertical-range`,min:.5,max:12,step:.1,"onUpdate:modelValue":i[3]||=e=>E.value=e,style:o({accentColor:y.color})},null,4)),[[ee,E.value]]):t(``,!0),F.value===`text`?te((a(),m(`input`,{key:1,ref_key:`range`,ref:Ie,type:`range`,class:`vertical-range`,min:3,max:48,step:.1,"onUpdate:modelValue":i[4]||=e=>N.value=e,style:o({accentColor:y.color})},null,4)),[[ee,N.value]]):t(``,!0)],6)):t(``,!0),(a(),m(`svg`,{"data-mode":F.value,ref_key:`svgElement`,ref:Y,xmlns:n(v),viewBox:ge.value,class:e({"vue-ui-pen-and-paper":!0,inactive:!y.active}),onMousedown:i[5]||=e=>F.value===`draw`?Te(e):F.value===`line`||F.value===`arrow`?Oe(e):null,onMousemove:i[6]||=e=>F.value===`draw`?Ee(e):F.value===`line`||F.value===`arrow`?ke(e):null,onMouseup:i[7]||=e=>F.value===`draw`?Q(e):F.value===`line`||F.value===`arrow`?Z(e):null,onMouseleave:i[8]||=e=>F.value===`draw`?Q(e):F.value===`line`||F.value===`arrow`?Z(e):null,onTouchstart:i[9]||=p(e=>F.value===`draw`?Te(e):F.value===`line`||F.value===`arrow`?Oe(e):null,[`prevent`]),onTouchmove:i[10]||=p(e=>F.value===`draw`?Ee(e):F.value===`line`||F.value===`arrow`?ke(e):null,[`prevent`]),onTouchend:i[11]||=e=>F.value===`draw`?Q(e):F.value===`line`||F.value===`arrow`?Z(e):null,onTouchcancel:i[12]||=e=>F.value===`draw`?Q(e):F.value===`line`||F.value===`arrow`?Z(e):null},[h(`g`,{ref_key:`G`,ref:D},[(a(!0),m(d,null,l(C.value,e=>(a(),m(d,{key:e.id},[e.path&&e.path.replace(`M`,``).split(` `).length===2?(a(),m(`circle`,{key:0,cx:e.path.replace(`M`,``).split(` `)[0],cy:e.path.replace(`M`,``).split(` `)[1],r:e.strokeWidth/2,fill:e.color},null,8,ce)):e.type===`line`?(a(),m(`line`,{key:1,class:`vue-ui-pen-and-paper-path`,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stroke:e.color,"stroke-width":e.strokeWidth},null,8,le)):e.type===`arrow`?(a(),m(`line`,{key:2,class:`vue-ui-pen-and-paper-path`,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stroke:e.color,"stroke-width":e.strokeWidth,"marker-end":`url(#${L.value})`},null,8,ue)):e.path?(a(),m(`path`,{key:3,class:`vue-ui-pen-and-paper-path`,d:e.path,stroke:e.color,"stroke-width":e.strokeWidth,fill:`none`},null,8,de)):e.type===`text`?(a(),m(`text`,{key:4,x:e.x,y:e.y,fill:e.color,"font-size":e.fontSize,"font-family":`sans-serif`,"dominant-baseline":`hanging`,class:`vue-ui-pen-and-paper-text`},[(a(!0),m(d,null,l(e.lines,(t,n)=>(a(),m(`tspan`,{key:n,x:e.x,dy:n===0?`0`:e.fontSize*1.2},s(t.length?t:`窶義),9,pe))),128))],8,fe)):t(``,!0)],64))),128))],512),q.value?(a(),m(`path`,{key:0,class:`vue-ui-pen-and-paper-path vue-ui-pen-and-paper-path-drawing`,d:Ae(J.value),stroke:T.value,"stroke-width":E.value*1.1,fill:`none`},null,8,me)):t(``,!0)],42,se))],64))}},[[`__scopeId`,`data-v-ea4aacae`]]);export{x as default};