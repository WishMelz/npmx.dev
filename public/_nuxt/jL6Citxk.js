function e(e){return e.reduce((e,t)=>e+t,0)}function t(e,t,n){return e<t?t:e>n?n:e}function n(e,t){let n=e.length;if(n===0)return 0;if(t<=0){let t=e[0];return t===void 0?0:t}if(t>=1){let t=e[n-1];return t===void 0?0:t}let r=(n-1)*t,i=Math.floor(r),a=Math.ceil(r),o=r-i,s=e[i];return s+(e[a]-s)*o}function r(e,r,i){let a=e.toSorted((e,t)=>e-t),o=n(a,r),s=n(a,i);return e.map(e=>t(e,o,s))}function i(t){let n=[];for(let e=0;e<t.length;e+=1){let r=t[e];r!=null&&n.push({value:r,index:e})}let i=n.length;if(i===0)return{mean:0,standardDeviation:0,coefficientOfVariation:null,slope:0,rSquared:null,interpretation:{volatility:`undefined`,trend:`undefined`}};if(i===1)return{mean:n[0]?.value??0,standardDeviation:0,coefficientOfVariation:null,slope:0,rSquared:null,interpretation:{volatility:`very_stable`,trend:`none`}};let a=0;for(let e of n)a+=e.value;let o=a/i,s=0;for(let e of n){let t=e.value-o;s+=t*t}let c=Math.sqrt(s/i),l=o===0?null:c/o,u=[];for(let e of n)u.push(e.value);let d=u.length>=20?r(u,.05,.95):u,f=0,p=0,m=0,h=0;for(let e=0;e<n.length;e+=1){let t=n[e],r=d[e];if(t===void 0||r===void 0)continue;let i=t.index;f+=i,p+=r,m+=i*r,h+=i*i}let g=i*h-f*f,_=g===0?0:(i*m-f*p)/g,v=null;if(g!==0){let e=p/i,t=(p-_*f)/i,r=0,a=0;for(let i=0;i<n.length;i+=1){let o=n[i],s=d[i];if(o===void 0||s===void 0)continue;let c=o.index,l=s-e;r+=l*l;let u=s-(_*c+t);a+=u*u}r!==0&&(v=1-a/r)}let y=`undefined`;l!==null&&(y=l<.1?`very_stable`:l<.25?`moderate`:`volatile`);let b=0;d.length>0&&(b=e(d)/d.length);let x=b===0?0:Math.abs(_)/b,S=`undefined`;return c===0?S=`none`:v!==null&&(S=v>.75?`strong`:v>.4?`weak`:`none`,S===`none`?x>=.03&&(S=`weak`):S===`weak`&&x>=.06&&(S=`strong`)),{mean:o,standardDeviation:c,coefficientOfVariation:l,slope:_,rSquared:v,interpretation:{volatility:y,trend:S}}}function a({dataset:e,config:t}){if(!e)return``;let n=e.lines.map(({name:e,series:n})=>({name:e,...i(n),dates:t.formattedDates,hasEstimation:t.hasEstimation})),r={daily:`package.trends.granularity_daily`,weekly:`package.trends.granularity_weekly`,monthly:`package.trends.granularity_monthly`,yearly:`package.trends.granularity_yearly`}[t.granularity]??`package.trends.granularity_weekly`,a=String(t.$t(r)).toLocaleLowerCase(),o=n.map((e,n)=>{let r=(()=>{switch(e.interpretation.trend){case`none`:return t.$t(`package.trends.copy_alt.trend_none`);case`weak`:return t.$t(`package.trends.copy_alt.trend_weak`);case`strong`:return t.$t(`package.trends.copy_alt.trend_strong`);default:return t.$t(`package.trends.copy_alt.trend_undefined`)}})();return t.$t(`package.trends.copy_alt.analysis`,{package_name:e.name,start_value:t.formattedDatasetValues[n]?.[0]??0,end_value:t.formattedDatasetValues[n]?.at(-1)??0,trend:r,downloads_slope:t.numberFormatter(e.slope)})}).join(`, `),s=n.length===1,c=t.hasEstimation?` ${s?t.$t(`package.trends.copy_alt.estimation`):t.$t(`package.trends.copy_alt.estimations`)}`:``,l=`${t.$t(`package.trends.copy_alt.compare`,{packages:n.map(e=>e.name).join(`, `)})} `,u=`${t.$t(`package.trends.copy_alt.single_package`,{package:n?.[0]?.name??``})} `,d=t.$t(`package.trends.copy_alt.general_description`,{start_date:n?.[0]?.dates[0]?.text??`-`,end_date:n?.[0]?.dates.at(-1)?.text??`-`,granularity:a,packages_analysis:o,watermark:t.$t(`package.trends.copy_alt.watermark`),estimation_notice:c});return(s?u:l)+d}async function o({dataset:e,config:t}){let n=a({dataset:e,config:t});await t.copy(n)}function s({dataset:e,config:t}){if(!e)return``;let n=(e.bars[0]?.series??[]).map((e,n)=>({index:n,name:t.datapointLabels[n]??`-`,rawDownloads:e??0,downloads:t.numberFormatter(e??0)})),r=n.length>0?n.reduce((e,t)=>t.rawDownloads>e.rawDownloads?t:e):void 0,i=n.toReversed().filter(e=>e.index!==r?.index).map(e=>t.$t(`package.versions.copy_alt.per_version_analysis`,{version:e?.name??`-`,downloads:e?.downloads??`-`})).join(`, `),a=t.semverGroupingMode===`major`?t.$t(`package.versions.grouping_major`):t.$t(`package.versions.grouping_minor`);return`${t.$t(`package.versions.copy_alt.general_description`,{package_name:e?.bars[0]?.name??`-`,versions_count:n?.length,semver_grouping_mode:a.toLocaleLowerCase(),first_version:n[0]?.name??`-`,last_version:n.at(-1)?.name??`-`,date_range_label:t.dateRangeLabel??`-`,max_downloaded_version:r?.name??`-`,max_version_downloads:r?.downloads??`-`,per_version_analysis:i,watermark:t.$t(`package.trends.copy_alt.watermark`)})}`}async function c({dataset:e,config:t}){let n=s({dataset:e,config:t});await t.copy(n)}export{c as n,o as t};