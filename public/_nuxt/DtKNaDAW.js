import{Et as e,G as t}from"./BLt7TXlb.js";import{c as n}from"./CreLCcZP.js";import{t as r}from"./DQw8S1UI.js";import{r as i}from"./B5EGaAMl.js";var a=i();function o(e){let t=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(.+))?/);return t?{major:Number(t[1]),minor:Number(t[2]),patch:Number(t[3]),prerelease:t[4]??``}:{major:0,minor:0,patch:0,prerelease:``}}function s(e){let t=o(e);if(!t.prerelease)return``;let n=t.prerelease.match(/^([a-z]+)/i);return n?n[1].toLowerCase():``}function c(e){let t=new Map;for(let[n,r]of Object.entries(e)){let e=t.get(r);e?e.push(n):t.set(r,[n])}for(let e of t.values())e.sort((e,t)=>e===`latest`?-1:t===`latest`?1:e.localeCompare(t));return t}function l(e,t){let n=new Set(t);return e.filter(e=>!n.has(e))}function u(e){let t=o(e);return t.major===0?`0.${t.minor}`:String(t.major)}function d(e){return`${e}.x`}function f(e,t){return u(e)===u(t)}function p(e,t){let n=t.trim();if(n===``)return new Set(e);if(!(0,a.validRange)(n))return new Set;let r=new Set;for(let t of e)(0,a.satisfies)(t,n,{includePrerelease:!0})&&r.add(t);return r}var m=new Set([`preinstall`,`install`,`postinstall`]),h=/\bnpx\s+(?:--?\w+(?:=\S+)?\s+)*(@?[\w.-]+(?:\/[\w.-]+)?(?:@[\w.^~<>=|-]+)?)/g,g=/^(@[\w.-]+\/[\w.-]+|[\w.-]+)(?:@(.+))?$/;function _(e){if(!e)return{};let t={};for(let[n,r]of Object.entries(e)){if(!m.has(n))continue;h.lastIndex=0;let e;for(;(e=h.exec(r))!==null;){let n=e[1];if(!n)continue;let r=g.exec(n);if(r&&r[1]){let e=r[1],n=r[2]||`latest`;if(v(e))continue;e in t||(t[e]=n)}}}return t}function v(e){return new Set([`env`,`node`,`npm`,`yarn`,`pnpm`,`yes`,`no`,`quiet`,`shell`]).has(e)}function y(e){if(!e)return null;let t=[],n={};for(let r of m)e[r]&&(t.push(r),n[r]=e[r]);return t.length===0?null:{scripts:t,content:n,npxDependencies:_(e)}}var b=/^node\s+([\w./-]+)$/;function x(e){let t=b.exec(e);if(t?.[1]){let n=t[1].replace(/^\.\//,``);return n.includes(`../`)||n.includes(`./`)?null:{prefix:e.slice(0,t.index+t[0].indexOf(t[1])),filePath:n}}return null}var S=5;function C(e){return!!e.dist.attestations}function w(e){return!!e._npmUser?.trustedPublisher}function T(e){return w(e)?`trustedPublisher`:C(e)?`provenance`:`none`}function E(e,t){let n=new Set(Object.values(e[`dist-tags`]??{})),r=Object.keys(e.versions).filter(t=>e.time[t]).sort((t,n)=>{let r=e.time[t],i=e.time[n];return!r||!i?0:new Date(i).getTime()-new Date(r).getTime()}).slice(0,S),i=new Set([...r,...n]);t&&e.versions[t]&&i.add(t);let a=Object.entries(e.versions).map(([t,n])=>{let r=T(n);return{version:t,time:e.time[t],hasProvenance:r!==`none`,trustLevel:r,deprecated:n.deprecated}}),o=new Set(a.map(e=>e.trustLevel)).size>1?a:void 0,s={},c=null;for(let n of i){let r=e.versions[n];if(r){if(r.version===t){let{readme:e,scripts:t,...n}=r,i=t?y(t):null;c={...n,installScripts:i??void 0}}let e=T(r);s[n]={hasProvenance:e!==`none`,trustLevel:e,version:r.version,deprecated:r.deprecated,tags:r.tags}}}let l={};e.time.modified&&(l.modified=e.time.modified),e.time.created&&(l.created=e.time.created);for(let t of i)e.time[t]&&(l[t]=e.time[t]);let u=e.license;u&&typeof u==`object`&&`type`in u&&(u=u.type);let d=(t?e.versions[t]:null)?.storybook,f=d&&typeof d==`object`&&`url`in d?{url:d.url}:void 0;return{_id:e._id,_rev:e._rev,name:e.name,description:e.description,"dist-tags":e[`dist-tags`],time:l,maintainers:e.maintainers,author:e.author,license:u,homepage:e.homepage,keywords:e.keywords,repository:e.repository,bugs:e.bugs,...f&&{storybook:f},requestedVersion:c,versions:s,securityVersions:o}}function D(i,a){let o=n(()=>`package:${e(i)}:${e(a)??``}`,async({$npmRegistry:t},{signal:n})=>{let{data:o,isStale:s}=await t(`/${r(e(i))}`,{signal:n});return{...E(o,e(a)),isStale:s}},`$vZzEhzMnZw`);return o.data.value?.isStale&&t(()=>{o.refresh()}),o}export{p as a,d as c,l as i,f as l,x as n,s as o,c as r,u as s,D as t};